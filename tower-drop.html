<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Helix Jump</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f0f0f0;
            font-family: 'Arial', sans-serif;
            text-align: center;
        }
        canvas {
            display: block;
            border: 2px solid #333;
            background-color: #fff;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            border-radius: 10px;
        }
        .buttons-container {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 10;
        }
        .control-button {
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .control-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 8px rgba(0,0,0,0.15);
        }
    </style>
</head>
<body>
    <div class="buttons-container">
        <button class="control-button" id="left-button">←</button>
        <button class="control-button" id="right-button">→</button>
    </div>
    <script>
        // קוד המשחק שלך מכאן
        
        // גודל קבוע של הקנבס, כדי להתאים לעיצוב הקיים
        const CANVAS_WIDTH = 400;
        const CANVAS_HEIGHT = 600;

        // משתנים גלובליים
        var thumbnail, getThumb = "";
        var verify = 0;
        var palettes;
        var central, platform, bg, ball, lava;
        var Ellipse, ShadeEllipse;
        
        // טבלת ניקוד (Leaderboard) מלאה
        var leaderboard = [
            ["Arrowhead Co.", 13649],
            ["Ethan Botha", 2324],
            ["🐧 MrPenguin2 🐧", 4401],
            ["Dancing Doggle", 5599],
            ["Tsunamon", 1200],
            ["noahware", 74655],
            ["Clayton", 46587],
            ["Kochendorfer,Zachary", 20134],
            ["chris316213", 2326],
            ["Star Traveler", 5039],
            ["Lightning McCode", 2267],
            ["Thanksbeardgod", 3789],
            ["CHRISTIAN SCHOOL TRY HARD", 7160],
            ["WWescoat", 5128],
            ["DavidJAllen", 3821],
            ["MaxWhitten", 3338],
            ["20khagerty", 11169],
            ["megamanwhiz", 13124],
            ["ASSASSIN", 61723],
            ["Gray Strickland", 4898],
            ["raff", 5395],
            ["20khagerty", 108821],
            ["PriSSSSM", 4456],
            ["Matias M", 11904],
            ["HaZard_Luke", 27777],
            ["Caleb Taylor", 15028],
            ["Maria Alex", 23588],
            ["Ellie Sexton", 13232],
            ["GrantGoins", 46588],
            ["Brady Beard", 1929],
            ["iHack", 2145],
            ["timestruck", 1827],
            ["PanGalacticGargleBlaster", 6197],
            ["Nalin Theodore", 2072],
            ["Programster", 29080],
            ["Imgbrentlinger", 5718],
            ["Akiva Rosenberg", 65583],
            ["HoneyBadger1015", 61456],
            ["Jcofield.o", 17115],
            ["Bowtieman", 72190],
            ["Dylan721668", 6694],
            ["Computer?", 125670],
            ["Salamander Maniacs YT", 65576],
            ["Nikyan", 33740],
            ["braxtonbailey", 65386],
            ["The#1Pr🥔grammer", 88321],
            ["big sad", 62055],
            ["Austin", 43236],
            ["WWescoat", 9325],
            ["manny benitez", 5559],
            ["Robert McKenzie", 19898],
            ["Flagilament", 7824],
            ["angel.cruz", 40198],
            ["ACAlfredo", 1544],
            ["Devion Rennier", 6113],
            ["Declan Ross", 559],
            ["Andrew Karr", 3611],
            ["cool guy 24", 6552],
            ["misaboo918", 14925],
            ["bcruse12", 4880],
            ["xxxtentacion", 14891],
            ["Lampony Snicket", 5000],
            ["Aidan", 4276],
            ["Ethan Lee", 20937],
            ["Noah", 7785],
            ["siddadi1819", 4222],
            ["J.Ramirez", 1653],
            ["anandb", 1578],
            ["noarwhalmoo", 8173],
            ["Ethan Carpintero", 3157],
            ["511Slloth", 4699],
            ["BloodyBaron", 7383],
            ["HenryMcKeon3", 7649],
            ["jelly135", 15934],
            ["culobCoder", 30567],
            ["samson nwobi", 80921],
            ["LightningMc Code", 13198],
            ["LiquidKetchup", 1772],
            ["Declan Gibson", 2118],
            ["DaZe_sneenzy", 2377],
            ["Light in the Dark", 4114],
            ["K G", 1712],
            ["erand05", 5130],
            ["Angus MacGyver", 5916],
            ["CAMREN ALEXZANDER HUDSON", 8577],
            ["jedielijaho0", 125890],
            ["AnimTheTree", 5054],
            ["EmilyGRidenour", 7038],
            ["KikiNoelle", 1438],
            ["~The Mailbox Programmer~", 1355],
            ["Kochendorfer.Zackary", 40751],
            ["Wolf Studios", 4867],
            ["hmcknight01", 9685],
            ["Jeremy", 5008],
            ["elijah", 3998],
            ["Jay Rosa", 1756],
            ["Harrison P. Cevasco", 9127],
            ["Hotrod", 14567],
            ["A RANDOM GUY", 91094],
            ["Jo$h", 71234],
            ["Finder", 10919],
            ["Sye", 6407],
            ["Rohaam", 2268],
            ["CubsFan41", 2515],
            ["Benny", 13735],
            ["KingSwords", 9168],
            ["Alexander O.", 17030],
            ["Jilian", 196],
            ["Rebekah R.", 1243],
            ["Israel", 11532],
            ["Mr.JPrograms", 4851],
            ["AuttumStar", 929],
            ["Kingslay productions", 2113],
            ["₱ⱤØ₲Ɽ₳₥₥ł₦₲ ₭ł₦₲", 114898],
            ["👑👑👑Aidair Sanchez👑👑", 11657],
            ["T̵̢̹̤͑̌h̵̗̹̞͉̼̠̲̚ę̸̩̼̘̀̐͜͝n̴͎̼̜͙̜̻̾̑̋̔r̸͎̬̱̻͚̓̋̊͊͝y̵̫̓̉̑͗̈́", 5238],
            ["мя. Lємoиѕ", 2951],
            ["Duck Dino", 10679],
            ["benyaminaharon739", 109724],
            ["ツ🅷🅰🅲🅺🅴🆁 🅿🆁🅾🅳", 1342],
            ["❄PopsicleBoi❄", 4187],
            ["𝕀ℕ🔰𝔽𝕀𝕃𝕋ℝ𝔸𝕋𝕀𝕆ℕ", 4340],
        ];
        
        var sortArr = function(arr, ind){
            for(var i = 0; i < arr.length - 1; i++){
                for(var j = i + 1; j < arr.length; j++){
                    if(arr[j][ind] >= arr[i][ind]){
                        var temp = arr[j];
                        arr[j] = arr[i];
                        arr[i] = temp;
                        if(arr[j][0] === arr[i][0]){
                            arr.splice(i, 1);
                        }
                    }
                }
            }
        };
        sortArr(leaderboard, 1);
        
        // הגדרת הגופנים לשימוש, מה שפתר את השגיאה
        var fonts = ["Calibri Bold", "Arial Black", "Arial Black"];
        
        // מערכים
        var scenes = [true, false, false, false];
        var keys = [];
        var layers = [];
        var ptsEarned = [];
        var titles = [["Endless", 0], ["Play", 0], ["Leaderboard", 0], ["Credits", 0]];
        var Cur_Pal = 1;
        
        var switchCol = function(col1, col2){
            var r = red(col1), g = green(col1), b = blue(col1);
            
            r -= (r - red(col2)) / 10;
            g -= (g - green(col2)) / 10;
            b -= (b - blue(col2)) / 10;
            
            var newCol = color(r, g, b);
            return(newCol);
        };
        
        var updatePalette = function(index){
            if(index === undefined){
                index = Cur_Pal % (palettes.length - 1);
            }
            
            central = switchCol(central, palettes[index][0]);
            platform = switchCol(platform, palettes[index][1]);
            bg = switchCol(bg, palettes[index][2]);
            ball = switchCol(ball, palettes[index][3]);
            lava = switchCol(lava, palettes[index][4]);
        };
        
        //Player object
        var p = {
            begin : false,
            mode : "play",
            score : 0, highscore : 0,
            
            y : 215,
            prevLev : 0, level : 0,
            current : 0, goal : 15,
            
            jump : -9, maxJump : 9,
            
            Level : 1, gameOver : false,
            
            splatter : [],
            
            display : function(){
                push();
                    translate(width / 2, this.y);
                    scale(1 + sin(radians(this.bounce)) / 5, 1 - sin(radians(this.bounce)) / 5);
                    
                    if(this.level - this.prevLev > 2){
                        fill(255, 100, 50);
                        ellipse(0, 0, 40, 40);
                        for(var i = 0; i < 5; i++){
                            for(var j = 0; j < 2; j++){
                                stroke(255, 100 * j, 50 * j, 180);
                                strokeWeight(30 - i * 6);
                                
                                var randy = random(-3, 3) * i;
                                line(randy, i * -15, randy, i * -15 - 10);
                            }
                        }
                    }
                    noStroke();
                    
                    if(this.level - this.prevLev > 2){
                        fill(lerpColor(this.fill, color(255, 50, 0), 0.6));
                    } else {
                        fill(this.fill);
                    }
                    ellipse(0, 0, 30, 30);
                    
                    fill(255, 7.5);
                    for(var i = 0; i < 10; i++){
                        ellipse(2 + i / 2, -2 - i / 2, 20 - i / 2, 20 - i / 2);
                    }
                pop();
                
                for(var i = 0; i < this.splatter.length; i++){
                    fill(this.fill);
                    ellipse(this.splatter[i][0], this.splatter[i][1], this.splatter[i][4], this.splatter[i][4]);
                    stroke(255, 50);
                    strokeWeight(this.splatter[i][4] / 3);
                    noFill();
                    arc(this.splatter[i][0], this.splatter[i][1], this.splatter[i][4] / 3, this.splatter[i][4] / 3, 270, 360);
                    noStroke();
                    
                    this.splatter[i][0] += this.splatter[i][2];
                    this.splatter[i][1] += this.splatter[i][3];
                    this.splatter[i][3] += 0.25;
                    
                    if(this.splatter[i][0] < 0 || this.splatter[i][0] > width || this.splatter[i][1] < 0 || this.splatter[i][1] > height){
                        this.splatter.splice(i, 1);
                    }
                }
                
                if(!p.begin){
                    // שינוי עיצוב תיבת ההוראות
                    fill(0, 200);
                    noStroke();
                    rect(width / 2, height / 2, width * 0.8, 300);
                    
                    fill(255);
                    textFont(fonts[0]);
                    textSize(18);
                    Text("ARROW KEYS or SWIPE to move. \n\n AVOID discolored areas on the platforms. \n\n Click OK to start!", width / 2, height / 2 - 60);
                    
                    // שינוי עיצוב כפתור ה-OK
                    fill(255, 200, 50);
                    rect(width / 2, height / 2 + 80, 100, 40, 5);
                    fill(0);
                    textSize(20);
                    Text("OK", width / 2, height / 2 + 80);
                    
                    if(mouseY > height / 2 + 60 && mouseY < height / 2 + 100){
                        if(mouseX > width / 2 - 50 && mouseX < width / 2 + 50) {
                            this.point = true;
                            if(mouseIsPressed && verify === 0){
                                this.begin = true;
                                this.point = false;
                            }
                        } else {
                            this.point = false;
                        }
                    } else {
                        this.point = false;
                    }
                }
                
                if(this.point){
                    cursor("pointer");
                } else {
                    cursor("default");
                }
                
                return this;
            },
            
            run : function(){
                this.fill = ball;
                this.jump = constrain(this.jump, -this.maxJump, this.maxJump);
                this.y += this.jump;
                this.jump += 0.6;
                
                if(this.mode === "endless"){
                    this.goal = this.level + 10;
                }
                
                this.bounce -= (this.bounce - 0) / 4;
                
                return this;
            },
            
            move : function(){
                if(this.y >= 220){
                    this.y = 220;
                    
                    for(var i = 0; i < layers.length; i++){
                        layers[i].l -= this.jump;
                    }
                    
                    for(var i = 0; i < this.splatter.length; i++){
                        this.splatter[i][1] -= this.jump;
                    }
                }
                
                if(keys[RIGHT_ARROW] || (p.begin && document.getElementById("right-button").classList.contains("active"))){
                    for(var i = 0; i < layers.length; i++){
                        layers[i].angle += 5;
                    }
                }
                
                if(keys[LEFT_ARROW] || (p.begin && document.getElementById("left-button").classList.contains("active"))){
                    for(var i = 0; i < layers.length; i++){
                        layers[i].angle -= 5;
                    }
                }
                
                return this;
            },
            
            Score : function(){
                textFont(fonts[0]);
                textSize(70);
                push();
                translate(width / 2, 70);
                fill(0);
                text(this.score, 0, 0);
                fill(0, 100);
                text(this.score, -2, 1);
                pop();
                
                this.highscore = max(this.score, this.highscore);
                
                if(this.mode === "play"){
                    fill(255, 50, 50);
                    rect(width - 20, 10 + height / 2.5, 40, height / 2.5);
                    
                    fill(255, 200, 50);
                    rect(width - 20, 10 + height / 2.5 - (this.current / this.goal * height / 2.5) + (this.current / this.goal * height / 2.5) / 2, 40, this.current / this.goal * height / 2.5);
                }
                
                return this;
            },
            
            changeFill : function(){
                var r = red(this.fill);
                var g = green(this.fill);
                var b = blue(this.fill);
                
                var r2 = red(ball);
                var g2 = green(ball);
                var b2 = blue(ball);
                
                r -= (r - r2) / 10;
                g -= (g - g2) / 10;
                b -= (b - b2) / 10;
                
                this.fill = color(r, g, b);
                return this;
            },
        };
        
        //Layer object
        var Layer = function(l, angle){
            this.l = l;
            this.angle = angle;
            this.rand = 0;
            
            this.num = floor(random(2, 6));
            this.space = floor(random(this.num - 1));
            this.dis = floor(random(this.num));
            this.dist = 360 / this.num;
        };
        Layer.prototype.display = function(){
            push();
                translate(width / 2, this.l);
                
                //Pillar
                push();
                    translate(0, 50);
                    
                    fill(central);
                    noStroke();
                    rect(0, 0, 30, 400);
                    
                    fill(central, 20);
                    for(var i = 0; i < 20; i++){
                        rect(0, 0, 30 - i, 400);
                    }
                pop();
                
                //Platforms
                for(var i = 0; i < this.num; i++){
                    var ang = this.angle + this.dist * i;
                    
                    if(i !== this.space && (i !== this.dis || p.mode === "endless")){
                        if(i === this.dis && p.mode === "endless"){
                            fill(255, 0, 50);
                        } else {
                            fill(platform);
                        }
                        
                        push();
                            rotate(radians(ang));
                            rect(0, 0, 150, 25);
                            
                            //Shading
                            push();
                                rotate(radians(-ang));
                                
                                fill(0, 7.5);
                                rect(0, 0, 150, 25);
                                
                                fill(0, 5);
                                rect(0, 0, 150, 20);
                            pop();
                        pop();
                    }
                }
            pop();
            
            return this;
        };
        Layer.prototype.check = function(){
            var angle = p.y - this.l;
            
            if(angle <= 0 && angle > p.jump && this.l < 300){
                for(var i = 0; i < this.num; i++){
                    var ang = (this.angle + this.dist * i + 360) % 360;
                    
                    if(i !== this.space){
                        if(i === this.dis){
                            if(p.mode !== "endless"){
                                p.gameOver = true;
                            }
                        }
                        
                        if(ang < 100 && ang > 80){
                            p.jump = -10;
                            p.prevLev = p.level;
                            p.level++;
                            p.current++;
                            p.bounce = 100;
                            
                            if(p.mode === "play"){
                                if(p.current >= p.goal){
                                    p.current = 0;
                                    p.Level++;
                                    Cur_Pal++;
                                    
                                    for(var j = 0; j < 10; j++){
                                        ptsEarned.push([width / 2, -100, random(-10, 10), random(-10, -5), random(5, 10)]);
                                    }
                                }
                            }
                        }
                    }
                }
            }
            
            if(this.l > height){
                var newLayer = new Layer(-30, random(360));
                
                newLayer.rand = random(50, 100);
                
                if(p.mode === "endless"){
                    newLayer.dis = floor(random(newLayer.num));
                }
                
                if(p.score % 25 === 0 && p.score > 0){
                    newLayer.dis = -1;
                }
                
                layers.push(newLayer);
                
                this.l = -3000;
                this.rand = 0;
                
                p.score++;
                
                if(p.score % 50 === 0){
                    p.maxJump += 1;
                }
            }
            
            if(this.l < p.y - 30 && this.rand === 0 && this.l > -3000){
                this.rand = random(50, 100);
                
                if(p.mode === "endless"){
                    this.dis = floor(random(this.num));
                }
                
                if(p.score % 25 === 0 && p.score > 0){
                    this.dis = -1;
                }
                
                var newLayer = new Layer(this.l - 200, random(360));
                layers.push(newLayer);
            }
            
            return this;
        };
        
        //Game function
        var PlayScene = function(){
            if(p.gameOver){
                p.y = 215;
                p.jump = -9;
                p.gameOver = false;
                
                layers = [];
                for(var i = 0; i < 6; i++){
                    layers.push(new Layer(150 - i * 150, random(360)));
                }
                
                p.prevLev = p.level;
                p.level = 0;
                p.current = 0;
                
                scenes[0] = true;
                scenes[1] = false;
            }
            
            background(bg);
            
            if(p.mode === "endless" && p.y >= 300){
                fill(lava);
                noStroke();
                rect(width / 2, p.y + 20 + (height - p.y - 20) / 2, width, height - p.y - 20);
                
                p.y += 10;
                
                p.Level = 1;
                
                if(p.y > 400){
                    p.gameOver = true;
                }
            }
            
            for(var i = 0; i < layers.length; i++){
                layers[i].l -= p.jump;
                layers[i].display().check();
            }
            
            for(var i = 0; i < ptsEarned.length; i++){
                textFont(fonts[0]);
                textSize(ptsEarned[i][4] * 2);
                fill(255);
                text("+10", ptsEarned[i][0], ptsEarned[i][1]);
                ptsEarned[i][0] += ptsEarned[i][2] / 5;
                ptsEarned[i][1] += ptsEarned[i][3] / 5;
                ptsEarned[i][3] += 0.25 / 5;
                ptsEarned[i][4] -= 0.1;
                if(ptsEarned[i][4] < 0){
                    ptsEarned.splice(i, 1);
                }
            }
            
            p.move().run().changeFill().display().Score();
            
            updatePalette();
        };
        
        //Menu function
        var MenuScene = function(){
            background(bg);
            
            if(p.mode === "endless"){
                fill(lava);
                rect(width / 2, p.y + 20 + (height - p.y - 20) / 2, width, height - p.y - 20);
            }
            
            fill(central);
            noStroke();
            rect(width / 2, height / 2 + 100, 30, height / 2);
            fill(central, 20);
            for(var i = 0; i < 20; i++){
                rect(width / 2, height / 2 + 100, 30 - i, height / 2);
            }
            
            for(var i = 0; i < layers.length; i++){
                layers[i].l -= p.jump;
                layers[i].angle -= 1;
                layers[i].display();
            }
            
            p.run().changeFill().display();
            
            // טקסטים בתפריט הראשי עם מרווחים מתוקנים
            textFont(fonts[1]);
            textSize(60);
            Text("Helix\nJump", width / 2, 120, color(50, 150, 250));
            
            if(p.score !== 0){
                textFont(fonts[0]);
                textSize(28);
                Text("Your Score: " + p.score + "\nBest: " + p.highscore, width / 2, 220, color(50, 150, 250));
            }
            
            textFont(fonts[0]);
            textSize(25);
            Text("Level " + p.Level, width / 2, 280, color(255, 200, 50));
            
            for(var i = 0; i < titles.length; i++){
                fill(0, titles[i][1]);
                noStroke();
                rect(width / 2, 350 + i * 50, 250, 40, 5); //Rounded corners for buttons
                
                titles[i][1] -= (titles[i][1] - 0) / 5;
                
                if(mouseY > 330 + i * 50 && mouseY < 370 + i * 50){
                    titles[i][1] = 100;
                    if(mouseIsPressed && verify === 0){
                        switch(i){
                            case 0:
                                p.mode = "endless";
                                scenes[0] = false;
                                scenes[1] = true;
                                layers = [];
                                for(var j = 0; j < 6; j++){
                                    layers.push(new Layer(150 - j * 150, random(360)));
                                }
                                break;
                            case 1:
                                p.mode = "play";
                                scenes[0] = false;
                                scenes[1] = true;
                                layers = [];
                                for(var j = 0; j < 6; j++){
                                    layers.push(new Layer(150 - j * 150, random(360)));
                                }
                                break;
                            case 2:
                                scenes[0] = false;
                                scenes[2] = true;
                                break;
                            case 3:
                                scenes[0] = false;
                                scenes[3] = true;
                                break;
                        }
                    }
                }
                
                fill(255);
                textFont(fonts[0]);
                textSize(25);
                Text(titles[i][0], width / 2, 350 + i * 50);
            }
            
            updatePalette();
        };
        
        //Leaderboard function
        var Leaderboard = function(){
            background(palettes[Cur_Pal - 1][2]);
            
            textFont(fonts[1]);
            textSize(40);
            Text("Leaderboard", width / 2, 50, color(255));
            
            for(var i = 0; i < 10; i++){
                textFont(fonts[0]);
                textSize(18);
                Text((i + 1) + ". " + leaderboard[i][0], width / 2 - 100, 100 + i * 25, color(255));
                Text(leaderboard[i][1], width / 2 + 100, 100 + i * 25, color(255));
            }
            
            fill(0, 100);
            noStroke();
            rect(width / 2, height - 50, 200, 40, 5); //Rounded corners for button
            
            if(mouseY > height - 70 && mouseY < height - 30){
                fill(0, 150);
                rect(width / 2, height - 50, 200, 40, 5); //Rounded corners for button
                cursor("pointer");
                if(mouseIsPressed && verify === 0){
                    scenes[0] = true;
                    scenes[2] = false;
                }
            } else {
                cursor("default");
            }
            
            fill(255);
            textFont(fonts[0]);
            textSize(25);
            Text("Back", width / 2, height - 50, color(255, 255, 255));
            
            updatePalette();
        };
        
        //Credits function
        var Credits = function(){
            background(palettes[Cur_Pal - 1][2]);
            
            textFont(fonts[1]);
            textSize(40);
            Text("Credits", width / 2, 50, color(255));
            
            textFont(fonts[0]);
            textSize(24);
            Text("All Code by\n    ARROWHEAD CO.\n\nBased on\nHELIX JUMP by\n    VOODOO", width / 2, height / 2 - 50, color(255));
            
            fill(0, 100);
            noStroke();
            rect(width / 2, height - 50, 200, 40, 5); //Rounded corners for button
            
            if(mouseY > height - 70 && mouseY < height - 30){
                fill(0, 150);
                rect(width / 2, height - 50, 200, 40, 5); //Rounded corners for button
                cursor("pointer");
                if(mouseIsPressed && verify === 0){
                    scenes[0] = true;
                    scenes[3] = false;
                }
            } else {
                cursor("default");
            }
            
            fill(255);
            textFont(fonts[0]);
            textSize(25);
            Text("Back", width / 2, height - 50, color(255, 255, 255));
            
            updatePalette();
        };
        
        //Background function
        var BG = function(){
            background(bg);
            
            push();
                translate(width / 2, 250);
                
                fill(central);
                noStroke();
                rect(0, 0, 30, 400);
                
                fill(central, 20);
                for(var i = 0; i < 20; i++){
                    rect(0, 0, 30 - i, 400);
                }
            pop();
            
            var layer = new Layer(100, 0);
            layer.num = 4;
            layer.dist = 90;
            layer.display();
        };
        
        //Intro screen
        var Intro = function(){
            background(bg);
            
            textAlign(CENTER, CENTER);
            textFont(fonts[1]);
            textSize(60);
            Text("Helix\nJump", width / 2, 120, color(50, 150, 250));
            
            textFont(fonts[0]);
            textSize(24);
            Text("All Code by\n    ARROWHEAD CO.\n\nBased on\nHELIX JUMP by\n    VOODOO", width / 2, height / 2, color(255, 255, 255));
        };
        
        // Custom Text function to handle multiline text
        var Text = function(str, x, y, c) {
            if (c) {
                fill(c);
            }
            
            var lines = str.split('\n');
            var lineHeight = (textSize() * 1.2);
            var totalHeight = lines.length * lineHeight;
            
            push();
            if(textAlign() === CENTER){
                translate(x, y - totalHeight / 2 + lineHeight / 2);
                for (var i = 0; i < lines.length; i++) {
                    text(lines[i], 0, i * lineHeight);
                }
            } else {
                translate(x, y);
                for (var i = 0; i < lines.length; i++) {
                    text(lines[i], 0, i * lineHeight);
                }
            }
            pop();
        };

        // p5.js setup() function
        function setup() {
            var canvas = createCanvas(CANVAS_WIDTH, CANVAS_HEIGHT);
            canvas.style('display', 'block');
            
            smooth();
            noStroke();
            rectMode(CENTER); // Changed to CENTER
            textAlign(CENTER, CENTER);
            
            // Initialize palettes
            palettes = [
                [color(255, 255, 255), color(249, 241, 219), color(252, 213, 129), color(213, 41, 65), color(153, 13, 53)],
                [color(248, 244, 227), color(255, 137, 102), color(42, 43, 42), color(112, 108, 157), color(229, 68, 109)],
                [color(255, 228, 250), color(225, 218, 189), color(71, 99, 152), color(141, 200, 178), color(255, 196, 35)],
                [color(249, 234, 225), color(19, 190, 156), color(170, 153, 143), color(204, 139, 134), color(125, 79, 80)],
                [color(228, 214, 167), color(200, 130, 196), color(28, 17, 10), color(80, 162, 167), color(155, 41, 21)],
                [color(165, 196, 212), color(123, 109, 141), color(73, 59, 42), color(132, 153, 177), color(89, 63, 98)],
                [color(255, 238, 242), color(255, 200, 251), color(89, 87, 88), color(185, 188, 223), color(255, 146, 194)],
                [color(255, 253, 253), color(240, 225, 0), color(11, 60, 73), color(183, 190, 188), color(125, 35, 109)],
                [color(203, 121, 58), color(154, 3, 30), color(50, 19, 37), color(95, 15, 64), color(252, 220, 77)],
                [color(178, 221, 247), color(76, 181, 174), color(100, 180, 200), color(202, 186, 200), color(255, 32, 62)],
                [color(178, 221, 247), color(48, 107, 172), color(20, 27, 65), color(11, 156, 235), color(145, 142, 244)],
                [color(232, 233, 243), color(177, 229, 242), color(39, 38, 53), color(166, 166, 168), color(200, 200, 200)],
                [color(247, 255, 221), color(219, 161, 89), color(232, 233, 155), color(239, 200, 128), color(208, 227, 204)],
                [color(0, 117, 196), color(214, 81, 8), color(239, 160, 11), color(239, 160, 11), color(89, 31, 10)],
                [color(240, 231, 216), color(166, 58, 80), color(177, 155, 150), color(186, 110, 110), color(201, 223, 74)],
                [color(246, 216, 174), color(244, 211, 94), color(46, 64, 87), color(8, 61, 119), color(218, 65, 103)],
                [color(241, 242, 235), color(86, 98, 70), color(74, 74, 72), color(164, 194, 165), color(216, 218, 211)],
                [color(255, 194, 226), color(110, 68, 255), color(184, 146, 255), color(255, 144, 179), color(239, 122, 133)],
                [color(228, 223, 218), color(115, 29, 216), color(193, 102, 107), color(72, 169, 166), color(212, 180, 131)],
                [color(239, 214, 172), color(67, 37, 52), color(40, 61, 101), color(54, 88, 85), color(196, 73, 0)],
                [color(145, 245, 173), color(116, 82, 150), color(99, 42, 80), color(139, 158, 183), color(194, 232, 18)],
                [color(212, 228, 188), color(150, 172, 183), color(72, 35, 60), color(54, 85, 143), color(64, 55, 110)],
                [color(161, 204, 165), color(65, 93, 67), color(17, 29, 19), color(112, 151, 117), color(143, 155, 190)],
                [color(213, 230, 141), color(107, 5, 4), color(36, 16, 35), color(163, 50, 11), color(71, 160, 37)],
                [color(251, 251, 249), color(166, 52, 70), color(0, 0, 4), color(126, 25, 70), color(12, 98, 145)],
            ];
            
            central = color(255);
            platform = color(255);
            bg = color(255);
            ball = color(255);
            lava = color(255);
            
            for(var i = 0; i < 25; i++){
                updatePalette();
            }
            
            // יצירת שכבות ראשוניות למשחק
            for(var i = 0; i < 6; i++){
                layers.push(new Layer(150 - i * 150, random(360)));
            }
            
            // יצירת תמונות מראש
            var EllipseGraphics = createGraphics(125, 110);
            EllipseGraphics.noStroke();
            EllipseGraphics.fill(255);
            EllipseGraphics.ellipse(125 / 2, 55, 125, 110);
            Ellipse = EllipseGraphics;
            
            var ShadeEllipseGraphics = createGraphics(125, 110);
            ShadeEllipseGraphics.noStroke();
            ShadeEllipseGraphics.fill(0, 7.5);
            for(var i = 0; i < 9; i++){
                ShadeEllipseGraphics.rect(0, 0, i * 2, 110);
            }
            ShadeEllipse = ShadeEllipseGraphics;

            // Event listeners for control buttons
            document.getElementById('left-button').addEventListener('mousedown', () => { keys[LEFT_ARROW] = true; });
            document.getElementById('left-button').addEventListener('mouseup', () => { keys[LEFT_ARROW] = false; });
            document.getElementById('right-button').addEventListener('mousedown', () => { keys[RIGHT_ARROW] = true; });
            document.getElementById('right-button').addEventListener('mouseup', () => { keys[RIGHT_ARROW] = false; });
            
            document.getElementById('left-button').addEventListener('touchstart', (e) => { e.preventDefault(); document.getElementById('left-button').classList.add('active'); });
            document.getElementById('left-button').addEventListener('touchend', (e) => { e.preventDefault(); document.getElementById('left-button').classList.remove('active'); });
            document.getElementById('right-button').addEventListener('touchstart', (e) => { e.preventDefault(); document.getElementById('right-button').classList.add('active'); });
            document.getElementById('right-button').addEventListener('touchend', (e) => { e.preventDefault(); document.getElementById('right-button').classList.remove('active'); });
        }

        // p5.js draw() function
        function draw() {
            background(255);
            
            if(scenes[1]){
                PlayScene();
            } else {
                BG();
            }
            
            if(scenes[0]){
                MenuScene();
            }
            if(scenes[2]){
                Leaderboard();
            }
            if(scenes[3]){
                Credits();
            }
            
            if(getThumb === "saycheese;]"){
                Cur_Pal = 17;
                
                thumbnail = get(0, 0, width, height);
                
                fill(255);
                rect(0, 0, width, height);
                image(thumbnail, width * width / height / 4, 0, width * width / height, height);
            }
        };

        // פונקציה להתאמת גודל הקנבס לגודל החלון
        function windowResized() {
            // כעת הקנבס בגודל קבוע, אז אין צורך לשנות את הגודל
        }
        
        //Key pressed
        var keyPressed = function(){
            keys[keyCode] = true;
        };
        var keyReleased = function(){
            keys[keyCode] = false;
        };
        
        //Mouse pressed
        var mousePressed = function(){
            verify = 1;
        };
        var mouseReleased = function(){
            verify = 0;
        };
        
        //Mouse dragged
        var mouseDragged = function(){
            if(scenes[1] && p.begin){
                if(mouseY > pmouseY){
                    for(var i = 0; i < layers.length; i++){
                        layers[i].angle += 5;
                    }
                }
                if(mouseY < pmouseY){
                    for(var i = 0; i < layers.length; i++){
                        layers[i].angle -= 5;
                    }
                }
            }
        };
        
        //Touch moved
        var touchMoved = function(){
            if(scenes[1] && p.begin){
                if(mouseY > pmouseY){
                    for(var i = 0; i < layers.length; i++){
                        layers[i].angle += 5;
                    }
                }
                if(mouseY < pmouseY){
                    for(var i = 0; i < layers.length; i++){
                        layers[i].angle -= 5;
                    }
                }
            }
        };
        
        //P.S. If the text looks offset, reload the page.
    </script>
</body>
</html>
